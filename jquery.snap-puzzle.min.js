// jQuery flexImages v1.0.0
// https://github.com/Pixabay/jQuery-snapPuzzle
!function(t){t.fn.snapPuzzle=function(o){function a(o){var a="sp_"+(new Date).getTime(),i=o.wrap('<span class="snappuzzle-wrap"/>').closest("span"),n=o.attr("src"),l=o.width()/p.columns,r=o.height()/p.rows,c=t(p.pile).addClass("snappuzzle-pile"),h=c.width()-l,d=c.height()-r;randomly=p.randomly,p.puzzle_class=a,o.data("options",p),randomly||s({pieceWidth:l,pieceHeight:r,columns:p.columns,rows:p.rows});for(var u=0;u<p.rows;u++)for(var f=0;f<p.columns;f++){var m=e({maxX:h,maxY:d});t('<div class="snappuzzle-piece '+a+'"/>').data("pos",u+"_"+f).css({width:l,height:r,position:"absolute",left:m.left,top:m.top,zIndex:Math.floor(10*Math.random()+1),backgroundImage:"url("+n+")",backgroundPosition:-f*l+"px "+-u*r+"px",backgroundSize:o.width()}).draggable({start:function(o,a){t(this).removeData("slot")},stack:".snappuzzle-piece",containment:p.containment}).appendTo(c).data("lastSlot",c),t('<div class="snappuzzle-slot '+a+'"/>').data("pos",u+"_"+f).css({width:l,height:r,left:f*l,top:u*r}).appendTo(i).droppable({accept:"."+a,hoverClass:"snappuzzle-slot-hover",drop:function(s,e){var i=t(this).data("pos");return t(".snappuzzle-piece."+a).each(function(){t(this).data("slot")==i&&(i=!1)}),i?(e.draggable.data("lastSlot",t(this)).data("slot",i),e.draggable.position({of:t(this),my:"left top",at:"left top"}),void(e.draggable.data("pos")==i&&(e.draggable.addClass("correct"),t(this).droppable("disable").css("opacity",1).fadeOut(1e3),e.draggable.css({opacity:0,cursor:"default"}).draggable("disable"),t(".snappuzzle-piece.correct."+a).length==p.rows*p.columns&&p.onComplete(o)))):!1}})}}function s(t){for(var o=0;o<t.rows;o++)for(var a=0;a<t.columns;a++)positions.push({left:a*t.pieceWidth,top:o*t.pieceHeight})}function e(t){var o;return o=randomly?{left:Math.floor(Math.random()*(t.maxX+1)),top:Math.floor(Math.random()*(t.maxY+1))}:i(positions.length)}function i(t){var o=n(t),a=positions[o];return o>-1&&positions.splice(o,1),a}function n(t){var o=0,a=t-1;return Math.floor(Math.random()*(a-o+1))+o}var p=t.extend({pile:"",randomly:!0,containment:"document",rows:5,columns:5,onComplete:function(){}},o);return positions=[],"string"==typeof o?(this.each(function(){var a=t(this),i=a.data("options"),n=a.width()/i.columns,p=a.height()/i.rows,l=t(i.pile),r=l.width()-n,c=l.height()-p,h=a.closest("span").offset(),d=l.offset();"destroy"==o?(t("."+i.puzzle_class).remove(),a.unwrap().removeData("options"),l.removeClass("snappuzzle-pile")):"refresh"==o&&(randomly||s({pieceWidth:n,pieceHeight:p,columns:i.columns,rows:i.rows}),t(".snappuzzle-slot."+i.puzzle_class).each(function(){var o=t(this).data("pos").split("_"),a=o[0],s=o[1];t(this).css({width:n,height:p,left:s*n,top:a*p})}),t(".snappuzzle-piece."+i.puzzle_class).each(function(){var o=e({maxX:r,maxY:c});if(t(this).data("slot")){var s=t(this).data("slot").split("_"),i=s[0],l=s[1],s=t(this).data("pos").split("_"),u=s[0],f=s[1];t(this).css({width:n,height:p,left:l*n+h.left-d.left,top:i*p+h.top-d.top,backgroundPosition:-f*n+"px "+-u*p+"px",backgroundSize:a.width()})}else{var s=t(this).data("pos").split("_"),m=s[0],g=s[1];t(this).css({width:n,height:p,left:o.left,top:o.top,backgroundPosition:-g*n+"px "+-m*p+"px",backgroundSize:a.width()})}}))}),this):this.each(function(){this.complete?a(t(this)):t(this).load(function(){a(t(this))})})}}(jQuery);
